\documentclass{report}

\include{structure.tex}

\begin{document}

\chapter{Part B}

\section{Δημιουργία Signed Distance Function}
Έχοντας μεθόδους που υπολογίζουν την απόσταση ενός σημείου από το mesh, και αν βρίσκεται εντός ή εκτός αυτού, δειγματοληπτείται
το AABB box του μοντέλου ώστε να δημιουργηθεί ένα ομοιόμορφο grid με σημεία που είναι γνωστές οι αποστάσεις τους 
από το μοντέλο. Επιλέχθηκαν 30 σημεία ανά άξονα, $30^3 = 27k$ σημεία σύνολο, που προσφέρουν αρκετά καλή ακρίβεια σε
επόμενα ερωτήματα.
\\\\
Για επαλήθευση ότι οι αποστάσεις των σημείων ευπολογίστηκαν σωστά, χρωματίζονται με βάση την απόστασή τους. Από μακρία
διακρίνεται αχνά, το περίγραμμα της γάτας.

\img[Φαίνεται το περίγραμμα τις γάτας στα πιο σκούρα σημεία, τα οποία βρίσκονται πιο κοντά στο mesh]{images/distances-outline.png}{20}

Για τα εσωτερικά σημεία, δημιουργούνται σφαίρες με κέντρο το σημείο και ακτίνα την απόσταση του από το mesh. Αν οι αποστάσεις έχουν
υπολογιστεί σωστά, οι σφαίρες δεν θα φάινονται από έξω αλλά θα εφάπτονται στο εσωτερικό του mesh. Όντως επαληθεύται αυτό 
όπως φαίνεται στην εικόνα \ref{fig:images/spheres.png}.

\img[Οι σφαίρες εφάπτονται στο εσωτερικό του mesh, όπως αναμένεται]{images/spheres.png}{20}

Οι αποστάσεις που υπολογίστηκαν για αυτό το grid χρησιμοποιούνται σε έναν trilinear interpolator της scipy \cite{2020SciPy-NMeth}
για να δημιουργηθεί το signed distance function.

\section{Ray Marching Algorithm}
Με το signed distance fucntion που δημιουργήθηκε, μπορεί να εφαρμοστεί ο αλγόριθμος ray marching για να υπολογιστεί η
προβολή του mesh στο επίπεδο. Ο αλγόρθμος επιστέφει αν κάποιο ακτίνα που εκπέμπεται από κάποιο σημείο τέμνεται με το mesh.
Έτσι, θεωρόντας ακτίνες που εκπέμπεται από τα τυχαία επιλεγμένα σημεία του επιπέδου, με κατεύθυνση κάθετη προς αυτό, δηλαδή
την διεύθυνση του normal του, χρωματίζονται κόκκινα τα σημεία που οι ακτίνες τους τέμνουν το mesh και μαύρα τα υπόλοιπα.

\img[Προβολή του mesh στο επίπεδο με τον αλγόριθμο ray marching]{images/ray-marching-proj.png}{20}

Ο αλγόριθμος ray marching θεωρεί τις ακτίνες από τα σημεία ως μια συνράρτηση $f(t) = p + t \cdot d$, όπου $p$ το σημείο
αφαιτηρίας, $d$ η κατεύθυνση της ακτίνας και $t$ μια μεταβλητή. Αν $f(t_x)$ είναι εντός του mesh, τότε η ακτίνα τέμνει το mesh.
Για να βρεθεί το $t_x$, αν υπάρχει, αυξητικά ελέγχονται διάφορα $t$. Η επιλογή των κατάλληλων $t$ είναι κρίσιμη για την
απόδοση του αλγορίθμου και σε αυτό βοηθάει πολύ το signed distance function. Από το signed distance function, είναι 
γνωστή η ελάχιστη απόσταση κάθε σημείου από το mesh, έστω ${sdf}(t)$. Τότε είναι σίγουρο ότι το για $t < {sdf}(t)$ η ακτίνα
δεν τέμνει το mesh. Έτσι επιλέγται βήμα λίγο μικτότερο του ${sdf}(t)$ για το επόμενο $t$. Αν το ${sdf}(t)$ είναι πολύ μικρό,
τότε πιθανό να χρειαστούν πολλά βήματα μέχρι να φτάσει η ακτίνα στο mesh. Οπότε επιλέγεται κάποια απόσταση "κατώφλι" όπου
αν ${sdf}(t) < \epsilon$, θεωτείται ότι η ακτίνα τέμνει το mesh. Σε αυτήν την υλοποίηση επιλέχθηκε $\epsilon = 10^{-3}$.
\cite{ray-marching}

\img[Περιγραφή του αλγορίθμου ray marching \cite{ray-marching-2}]{images/ray-marching.jpg}{20}

Ο αλγόριθμος τερματίζεται όταν ${sdf}(t) < \epsilon$ ή $t > t_{max}$, όπου $t_{max}$ μια μέγιστη τιμή για το $t$, που σημαίνει
ότι η ακτίνα έχει φτάσει πολύ μακρία από το mesh και δεν το τέμνει.

\img[Τελικές θέσεις των ακτίνων κατά την εκτέλεση του ray-marching αλγορίθμου]{images/final-positions.png}{20}

Ο αλγόριθμος ray-marching βασίζεται αρκετά στην ποιότητα του signed distance function. Αν το signed distance fucntion έχει
δημιουργηθεί από ένα πολύ αραιό grid, τα αποτελέσματα θα είναι αλοιωμένα καθώς το ${sdf}(t)$ δεν θα επιστρέφει μια
ικανοποιητική προσέγγιση της πραγματικής απόστασης του κάθε σημείου από το mesh.

\twoimgs{images/duck-bad.png}{Προβολή της πάππιας με grid από 15 σημεία ανά άξονα}{images/duck-better.png}{Προβολή της πάππιας με gird από 30 σημεία ανά άξονα} \label{fig:duck}

Όπως φαίνεται από τις εικόνες \ref{fig:images/duck-bad.png} και \ref{fig:images/duck-better}, για μικρή διγματοληψία grid 
χάνονται λεπτομέριες του mesh όπως το ράμφος της πάππιας. Με μεγαλύτερη δειγματοληψία βελτιώνεται το αποτέλεσμα και 
φαίνονται περισσότερες λεπτομέρειες αλλά όχι σε τέλειο βαθμό. Δείχνει ένα πρόβλημα του ray-marching αλγορίθμου και 
του signed distance function σε meshes με απότομες αλλαγές στην καμπυλότητα.

\clearpage
\selectlanguage{english}
\bibliographystyle{unsrt} % Specify bibliography style
\bibliography{references} % Include your bibliography file (references.bib)

\end{document}